{%extends 'goods/base.html'%}

{%block header%}
<script>
	//用户在列表页点击购物车调用的JS函数
	function add_cart(gid) {
		// 判断用户是否登陆
	    $.get('/user/islogin/',function(data){
	        if(data.result){
	            //登陆成功,讲商品添加至购物车中
				$.get('/cart/add/',{'gid':gid},function (data1) {
					if(data1.isadd){
					    //添加成功
						$.get('/cart/count/',function (data) {
						$('#show_count').text(data.cart_count)
                	})
					}
					else{
					    alert('购买失败，请稍后重试')
					}
                })
			}else{
	            //未登陆，则跳转登陆页,当再次登陆时，会被记录跳转至/user/islogin/中，解决方案是将该路径添加到中间件中
				location.href='/user/login/'
			}
		})
    }
	
</script>


{%endblock header%}


{%block daohang%}

	<div class="breadcrumb">
		<a href="#">全部分类</a>
		<span>></span>
		<a href="#">{{t1.ttitle}}</a>
	</div>

{%endblock daohang%}



{%block right%}
		<div class="r_wrap fr clearfix">
			<div class="sort_bar">
				<a href="/list{{t1.id}}_1_1/"{%if orderby == '1'%}class="active"{%endif%}>默认</a>
				<a href="/list{{t1.id}}_1_2/?desc={%if desc == '1'%}0{%else%}1{%endif%}"{%if orderby == '2'%}class="active"{%endif%}>价格</a>
				<a href="/list{{t1.id}}_1_3/"{%if orderby == '3'%}class="active"{%endif%}>人气</a>
			</div>

			<ul class="goods_type_list clearfix">
				{%for p in page%}
				<li>
					<a href="/{{p.id}}/"><img src="/static/{{p.gpic}}"></a>
					<h4><a href="/{{p.id}}/">{{p.gtitle}}</a></h4>
					<div class="operate">
						<span class="prize">￥{{p.gprice}}</span>
						<span class="unit">{{p.gprice}}/{{p.gunit}}</span>
						<a href="javascript:add_cart({{p.id}});" class="add_goods" title="加入购物车"></a>
					</div>
				</li>
				{%endfor%}
			</ul>


			<div class="pagenation">
				{%if page.has_previous%}
				<a href="/list{{t1.id}}_1_1/?desc={{desc}}">首页</a>
				<a href="/list{{t1.id}}_{{page.number|add:-1}}_{{orderby}}/"><上一页</a>
				{%endif%}
				{%for pindex in page_range%}
				{%if pindex == page.number%}
				<a href="#" class="active">{{pindex}}</a>
				{%else%}
				<a href="/list{{t1.id}}_{{pindex}}_{{orderby}}/?desc={{desc}}">{{pindex}}</a>
				{%endif%}
				{%endfor%}
				{%if page.has_next%}
				<a href="/list{{t1.id}}_{{page.number|add:1}}_{{orderby}}/">下一页></a>
				<a href="/list{{t1.id}}_{{page.paginator.num_pages}}_{{orderby}}/?desc={{desc}}">末页></a>
				{%endif%}
			</div>
		</div>


{%endblock right%}
